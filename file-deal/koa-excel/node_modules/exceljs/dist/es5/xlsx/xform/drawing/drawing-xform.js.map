{"version":3,"sources":["../../../../../lib/xlsx/xform/drawing/drawing-xform.js"],"names":["utils","require","colCache","XmlStream","BaseXform","TwoCellAnchorXform","OneCellAnchorXform","WorkSheetXform","module","exports","map","getAnchorType","model","range","decode","br","inherits","DRAWING_ATTRIBUTES","tag","prepare","anchors","forEach","item","index","anchorType","anchor","render","xmlStream","openXml","StdDocAttributes","openNode","closeNode","parseOpen","node","parser","name","reset","parseText","text","parseClose","push","undefined","reconcile","options"],"mappings":"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","file":"drawing-xform.js","sourcesContent":["'use strict';\n\nconst utils = require('../../../utils/utils');\nconst colCache = require('../../../utils/col-cache');\nconst XmlStream = require('../../../utils/xml-stream');\n\nconst BaseXform = require('../base-xform');\nconst TwoCellAnchorXform = require('./two-cell-anchor-xform');\nconst OneCellAnchorXform = require('./one-cell-anchor-xform');\n\nconst WorkSheetXform = (module.exports = function() {\n  this.map = {\n    'xdr:twoCellAnchor': new TwoCellAnchorXform(),\n    'xdr:oneCellAnchor': new OneCellAnchorXform(),\n  };\n});\n\nfunction getAnchorType(model) {\n  const range = typeof model.range === 'string' ? colCache.decode(model.range) : model.range;\n\n  return range.br ? 'xdr:twoCellAnchor' : 'xdr:oneCellAnchor';\n}\n\nutils.inherits(\n  WorkSheetXform,\n  BaseXform,\n  {\n    DRAWING_ATTRIBUTES: {\n      'xmlns:xdr': 'http://schemas.openxmlformats.org/drawingml/2006/spreadsheetDrawing',\n      'xmlns:a': 'http://schemas.openxmlformats.org/drawingml/2006/main',\n    },\n  },\n  {\n    get tag() {\n      return 'xdr:wsDr';\n    },\n\n    prepare(model) {\n      model.anchors.forEach((item, index) => {\n        item.anchorType = getAnchorType(item);\n        const anchor = this.map[item.anchorType];\n        anchor.prepare(item, { index });\n      });\n    },\n\n    render(xmlStream, model) {\n      xmlStream.openXml(XmlStream.StdDocAttributes);\n      xmlStream.openNode(this.tag, WorkSheetXform.DRAWING_ATTRIBUTES);\n\n      model.anchors.forEach(item => {\n        const anchor = this.map[item.anchorType];\n        anchor.render(xmlStream, item);\n      });\n\n      xmlStream.closeNode();\n    },\n\n    parseOpen(node) {\n      if (this.parser) {\n        this.parser.parseOpen(node);\n        return true;\n      }\n      switch (node.name) {\n        case this.tag:\n          this.reset();\n          this.model = {\n            anchors: [],\n          };\n          break;\n        default:\n          this.parser = this.map[node.name];\n          if (this.parser) {\n            this.parser.parseOpen(node);\n          }\n          break;\n      }\n      return true;\n    },\n\n    parseText(text) {\n      if (this.parser) {\n        this.parser.parseText(text);\n      }\n    },\n\n    parseClose(name) {\n      if (this.parser) {\n        if (!this.parser.parseClose(name)) {\n          this.model.anchors.push(this.parser.model);\n          this.parser = undefined;\n        }\n        return true;\n      }\n      switch (name) {\n        case this.tag:\n          return false;\n        default:\n          // could be some unrecognised tags\n          return true;\n      }\n    },\n\n    reconcile(model, options) {\n      model.anchors.forEach(anchor => {\n        if (anchor.br) {\n          this.map['xdr:twoCellAnchor'].reconcile(anchor, options);\n        } else {\n          this.map['xdr:oneCellAnchor'].reconcile(anchor, options);\n        }\n      });\n    },\n  }\n);\n"]}